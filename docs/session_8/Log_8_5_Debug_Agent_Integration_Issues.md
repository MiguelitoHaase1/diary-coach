# Session 8 - Increment 5: Debug - Agent Integration Issues

## Problem Summary

User reported two critical issues:
1. When asking for todos, the coach returns mock data instead of real Todoist tasks
2. When asking about core beliefs, the coach cannot access personal content

## Investigation Results

### Debug Script Findings

Created `test_multi_agent_debug.py` which revealed:

1. **Agents ARE being called correctly**:
   - MCP Agent: Successfully called and returns real task "Claude.md"
   - Personal Content Agent: Successfully called and returns real beliefs
   - Memory Agent: Ready and available
   - All agents properly registered in registry

2. **Agent triggers working**:
   - "What should I work on today?" → Correctly triggers MCP agent
   - "What are my core beliefs about productivity?" → Correctly triggers Personal Content agent

3. **Real data is available**:
   ```
   MCP Response: CURRENT TASKS:
   - [High Priority] Claude.md (Due: 2025-07-28)
   
   TASK SUMMARY:
   Total: 1 tasks | High Priority: 1 | Due Today: 0
   ```

### Root Cause Analysis

The issue appears to be that the LLM is generating mock todos in its response despite having real data in the enhanced prompt. The mock todos mentioned by the user:
- Call mom
- Pick up dry cleaning
- Review quarterly reports
- Gym session
- Grocery shopping

These do NOT exist in our codebase - they're being generated by the LLM.

### Possible Causes

1. **Prompt Integration Issue**: The agent context might not be clearly marked in the system prompt, causing the LLM to ignore it
2. **CLI Inheritance Chain**: MultiAgentCLI → EnhancedCLI → DiaryCoachCLI might have conflicting coach instances
3. **LLM Behavior**: The model might be trained to provide example todos when asked directly

### Evidence

From debug output:
- Agents are being called: `Agents called: ['mcp']`
- Real data is in the prompt: `CURRENT TASKS:\n- [High Priority] Claude.md (Due: 2025-07-28)`
- But coach response ignores it: "Good morning, Michael! What feels like the most important problem to solve today?"

## Next Steps

1. **Fix Prompt Integration**: Make agent context more prominent in system prompt
2. **Verify CLI Chain**: Ensure enhanced coach is actually being used throughout
3. **Add Debug Logging**: Show actual prompt being sent to LLM
4. **Test Direct Questions**: Coach should reference real data when asked about tasks

## Code Status

- ✅ Enhanced coach implementation complete
- ✅ Agent calling logic working
- ✅ All agents properly initialized
- ❌ LLM not using provided context effectively
- ❌ Need clearer prompt structure for context integration